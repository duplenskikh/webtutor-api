<h1 align="center">DAPI - инструмент для разработчиков WebSoft HCM</h1>

## Что это такое и зачем оно мне?

Данное программное решение предоставляет набор удобных инструментов для разработчиков WebSoft HCM, которое позволяет существенно сократить время на разработку и отладку программного кода: вам больше не нужно создавать отдельные документы в системе и копировать в них исходные коды, всё будет лежать в едином структурированном репозитории, поддержка hotreload позволит сразу же видеть внесенные изменения, а типизация избавит от опечаток и необходимости просмотра наличия тех или иных полей объектов или аргументов функций в исходных файлах системы.

#### Основные преимущества инструмента

- Гибкий оркестр запросов для реализации REST API
- Набор часто используемых утилит для работы с объектами и выборками
- Механизм hotreload
- Поддержка типизации
- Автоматизированная сборка проекта с возможностью настройки поставки

## Как начать с этим работать?

### Клонирование и установка зависимостей

Для начала работы необходимо иметь интернет соединение, установленный [Git](https://git-scm.com/) и [Node.js](https://nodejs.org/), если эти условия удовлетворены - выполняем клонирование данного репозитория к себе и устанавливаем [npm](https://www.npmjs.com/) зависимости, делается это с помощью нескольких простых команд в командной строке.


```bash
git clone https://github.com/umbrik/webtutor-api.git    # Клонирование репозитория
cd webtutor-api                                         # Переходим в директорию, куда был склонирован репозиторий 
npm i                                                   # Устанавливаем заивимости с помощью npm
```

### Работа с проектом в редакторе

Открываем директорию проекта в редакторе форматированного текста, например, [Visual Studio Code](https://code.visualstudio.com/) или любом другом, с поддержкой TypeScript.

#### Структура проекта

Ниже представлена структура проекта с кратким описанием его директорий.

```
webtutor-api/
├─ gulp/                    # Задачи для таск-менеджера Gulp
│  ├─ plugins
├─ src/                     # В данной директории расположен основной код проекта
│  ├─ controllers/          # Доступные для вызова через API функции
│  ├─ services/             # Функции для выполнения запросов и действий, вызываются из контроллеров 
│  ├─ utils/                # Общие функции для упрощения разработки, например - приведение даты в определенный формат
```

#### controllers

В данной директории предлагается размещать программный код для верхнеуровневых обработчиков пользовательских запросов.

Важно помнить, что функция будет доступна для вызова только если вы опишите её в специальной функции `functions()`, как показано на примере ниже.

```typescript
// Объявляем функцию `functions` и описываем какие endpoint будут доступны пользователю при обращении к ней
export function functions(): Route[] {
  return [{
    method: "GET",                  // HTTP метод
    pattern: "/collaborator",       // Адрес
    callback: "getCollaborator",    // Название вызываемой функции, расположенной в этом же файле
    access: "user"                  // Доступ к функции для пользователя или внешего приложения
  }];
}

// Объявляем функцию для вывода идентификатора текущего пользователя
export function getCollaborator(params: HandlerParams, Request: Request) {
  return dapi.utils.response.ok(`curUserID is ${Request.Session.Env.curUserID}`); // Возвращаем ответ, обернув в специальную функцию `ok`
}
```

В результате вышеописанных действий, пользователь сможет получить свой идентификатор, обратившись по адресу `https://your-server-address.ru/api/v1/collaborators/collaborator`, при этом - вам не нужно думать об аутентификации, так как этот процесс зашит в ядро оркестратора.
